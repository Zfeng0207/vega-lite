{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "description": "Malaysia proportional symbol map with year slider.",
  "width": 740,
  "height": 500,
  "projection": { "type": "mercator", "center": [110, 4.5], "scale": 1800 },

  "params": [
    {
      "name": "year_select",
      "value": 2017,
      "bind": { "input": "range", "name": "Year: ", "min": 2017, "max": 2024, "step": 1 }
    }
  ],

  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/deldersveld/topojson/master/countries/malaysia/malaysia-states.json",
        "format": { "type": "topojson", "feature": "states" }
      },
      "mark": { "type": "geoshape", "fill": "#f5f5f5", "stroke": "#999", "strokeWidth": 0.6 }
    },
    {
      "data": {
        "url": "labour_workforce_by_state.csv",
        "format": {
          "type": "csv",
          "parse": { "date": "%m/%d/%y", "lat": "number", "long": "number" }
        }
      },
      "transform": [
        { "calculate": "year(toDate(datum.date))", "as": "year" },
        { "filter": "datum.year == year_select" }
      ],
      "layer": [
        {
          "mark": { "type": "circle", "opacity": 0.85, "stroke": "white", "strokeWidth": 0.6 },
          "encoding": {
            "longitude": { "field": "long", "type": "quantitative" },
            "latitude": { "field": "lat", "type": "quantitative" },
            "size": {
              
              "field": "lf",
              "type": "quantitative",
              "title": "Labour force (’000)",
              "scale": { "type": "sqrt", "range": [40, 1400] }
            },
            "color": {
              "field": "u_rate",
              "type": "quantitative",
              "title": "Unemployment rate (%)",
              "scale": { "scheme": "reds" }
            },
            "tooltip": [
              { "field": "state", "type": "nominal" },
              { "field": "year", "type": "quantitative", "title": "Year" },
              { "field": "lf", "type": "quantitative", "title": "Labour force (’000)", "format": ",.1f" },
              { "field": "u_rate", "type": "quantitative", "title": "Unemployment rate (%)", "format": ".1f" }
            ]
          }
        },
        {
          "mark": { "type": "text", "dx": 7, "dy": -7, "fontSize": 10 },
          "encoding": {
            "longitude": { "field": "long", "type": "quantitative" },
            "latitude": { "field": "lat", "type": "quantitative" },
            "text": { "field": "state", "type": "nominal" }
          }
        }
      ]
    }
  ],

  "title": "Malaysia Labour Force & Unemployment (Year-filtered proportional symbols)"
}
