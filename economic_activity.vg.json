{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "title": "Malaysia GDP by Economic Activity (2019â€“2022)",
    "width": 720,
    "height": 720,
    "data": {
      "url": "https://raw.githubusercontent.com/Zfeng0207/vega-lite/refs/heads/main/gdp_cleaned.csv",
      "format": {
        "type": "csv",
        "parse": {"year": "number", "value rm million": "number"}
      }
    },
    "params": [
      {
        "name": "year_select",
        "value": 2022,
        "bind": {
          "input": "select",
          "options": [2019, 2020, 2021, 2022],
          "name": "Year: "
        }
      }
    ],
    "transform": [
      {"filter": "datum.year == year_select"},
      {"filter": "isValid(datum['value rm million']) && isFinite(+datum['value rm million'])"},
      {
        "joinaggregate": [
          {"op": "sum", "field": "value rm million", "as": "kind_total"}
        ],
        "groupby": ["kind of economic activity"]
      },
      {
        "joinaggregate": [
          {"op": "sum", "field": "value rm million", "as": "grand_total"}
        ]
      }
    ],
    "layer": [
      {
        "transform": [
          {
            "aggregate": [
              {"op": "sum", "field": "value rm million", "as": "value_kind"}
            ],
            "groupby": ["kind of economic activity", "grand_total"]
          },
          {"calculate": "datum.value_kind / datum.grand_total * 100", "as": "pct_total_kind"}
        ],
        "mark": {
          "type": "arc",
          "innerRadius": 80,
          "outerRadius": 160,
          "stroke": "white",
          "strokeWidth": 1
        },
        "encoding": {
          "theta": {"field": "value_kind", "type": "quantitative"},
          "color": {
            "field": "kind of economic activity",
            "type": "nominal",
            "scale": {
              "domain": [
                "Agriculture",
                "Mining and Quarrying",
                "Manufacturing",
                "Construction",
                "Services",
                "Plus: Import duties"
              ],
              "range": [
                "#1b9e77",
                "#d95f02",
                "#7570b3",
                "#e7298a",
                "#66a61e",
                "#e6ab02"
              ]
            },
            "legend": {"title": "Kind of Economic Activity"}
          },
          "tooltip": [
            {"field": "kind of economic activity", "title": "Kind"},
            {"field": "value_kind", "title": "GDP (RM Million)", "format": ",.0f"},
            {"field": "pct_total_kind", "title": "% of Total", "format": ".1f"}
          ]
        }
      },
      {
        "transform": [
          {
            "aggregate": [
              {"op": "sum", "field": "value rm million", "as": "value_sub"}
            ],
            "groupby": [
              "kind of economic activity",
              "sub kind of economic activity",
              "kind_total",
              "grand_total"
            ]
          },
          {"calculate": "datum.value_sub / datum.kind_total * 100", "as": "pct_parent_sub"},
          {"calculate": "datum.value_sub / datum.grand_total * 100", "as": "pct_total_sub"}
        ],
        "mark": {
          "type": "arc",
          "innerRadius": 160,
          "outerRadius": 260,
          "stroke": "white",
          "strokeWidth": 0.8
        },
        "encoding": {
          "theta": {"field": "value_sub", "type": "quantitative"},
          "color": {
            "field": "kind of economic activity",
            "type": "nominal",
            "scale": {
              "domain": [
                "Agriculture",
                "Mining and Quarrying",
                "Manufacturing",
                "Construction",
                "Services",
                "Plus: Import duties"
              ],
              "range": [
                "#1b9e77",
                "#d95f02",
                "#7570b3",
                "#e7298a",
                "#66a61e",
                "#e6ab02"
              ]
            },
            "legend": null
          },
          "opacity": {
            "field": "value_sub",
            "type": "quantitative",
            "legend": null,
            "scale": {"domain": [0, 200000], "range": [0.45, 1]}
          },
          "tooltip": [
            {"field": "kind of economic activity", "title": "Kind"},
            {"field": "sub kind of economic activity", "title": "Sub Kind"},
            {"field": "value_sub", "title": "GDP (RM Million)", "format": ",.0f"},
            {"field": "pct_parent_sub", "title": "% of Parent", "format": ".1f"},
            {"field": "pct_total_sub", "title": "% of Total", "format": ".1f"}
          ]
        }
      }
    ],
    "config": {
      "view": {"stroke": null},
      "arc": {"cornerRadius": 0}
    }
  }
  