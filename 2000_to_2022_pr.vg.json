{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "white",
  "autosize": {"type": "pad", "contains": "padding"},
  "data": {
    "url": "https://raw.githubusercontent.com/Zfeng0207/VegaLite/refs/heads/main/lfs_state_sex.csv",
    "format": {
      "type": "csv",
      "parse": {"date": "date", "lf": "number", "lf_outside": "number"}
    }
  },
  "transform": [
    {"calculate": "year(datum.date)", "as": "year"},
    {"filter": "datum.sex == 'male' || datum.sex == 'female'"},
    {
      "aggregate": [
        {"op": "sum", "field": "lf", "as": "lf_total"},
        {"op": "sum", "field": "lf_outside", "as": "lf_out_total"}
      ],
      "groupby": ["year", "sex"]
    },
    {
      "calculate": "(datum.lf_total / (datum.lf_total + datum.lf_out_total)) * 100",
      "as": "p_rate_nat"
    },
    {"calculate": "datetime(datum.year, 0, 1)", "as": "yearDate"}
  ],

  "hconcat": [
    {
      "width": 650,
      "height": 500,
      "title": "Malaysia Participation Rate by Sex",
      "mark": {"type": "line", "interpolate": "monotone", "strokeWidth": 3},
      "encoding": {
        "x": {
          "field": "yearDate",
          "type": "temporal",
          "scale": {"domain": {"param": "brush"}},
          "axis": {"format": "%Y", "title": "", "tickCount": 10, "labelFontSize": 14}
        },
        "y": {
          "field": "p_rate_nat",
          "type": "quantitative",
          "scale": {"domain": [40, 100]},
          "axis": {
            "title": "Participation Rate (%)",
            "tickCount": 13,
            "labelFontSize": 14,
            "titleFontSize": 16
          }
        },
        "color": {
          "field": "sex",
          "type": "nominal",
          "scale": {"domain": ["female", "male"], "range": ["#377eb8", "#ff7f0e"]},
          "title": "Sex"
        },
        "tooltip": [
          {"field": "year", "type": "quantitative", "title": "Year"},
          {"field": "sex", "type": "nominal", "title": "Sex"},
          {"field": "p_rate_nat", "type": "quantitative", "title": "Participation Rate (%)", "format": ".1f"},
          {"field": "lf_total", "type": "quantitative", "title": "Labour Force (sum)", "format": ",.0f"}
        ]
      }
    },
    {
      "width": 380,
      "height": 500,
      "title": {
        "text": "Brush here to zoom the left chart",
        "subtitle": "Drag across years to filter",
        "anchor": "start",
        "fontSize": 14,
        "subtitleFontSize": 12
      },
      "mark": {"type": "line", "interpolate": "monotone", "strokeWidth": 2},
      "params": [
        {"name": "brush", "select": {"type": "interval", "encodings": ["x"]}}
      ],
      "encoding": {
        "x": {
          "field": "yearDate",
          "type": "temporal",
          "axis": {"format": "%Y", "title": "", "labelFontSize": 12}
        },
        "y": {
          "field": "p_rate_nat",
          "type": "quantitative",
          "axis": {"tickCount": 5, "grid": true, "title": "", "labelFontSize": 12}
        },
        "color": {
          "field": "sex",
          "type": "nominal",
          "scale": {"domain": ["female", "male"], "range": ["#377eb8", "#ff7f0e"]},
          "legend": null
        }
      }
    }
  ],

  "config": {
    "axis": {"labelFontSize": 14, "titleFontSize": 16},
    "legend": {"titleFontSize": 14, "labelFontSize": 13},
    "style": {"cell": {"stroke": null}}
  }
}
