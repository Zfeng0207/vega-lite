{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 850,
    "height": 550,
    "title": "GDP by State and Kind of Economic Activity (RM Million)",
    "params": [
      {
        "name": "year_select",
        "value": 2022,
        "bind": {
          "input": "range",
          "min": 2019,
          "max": 2022,
          "step": 1,
          "name": "Year: "
        }
      }
    ],
    "data": {
      "url": "https://raw.githubusercontent.com/Zfeng0207/VegaLite/refs/heads/main/2005-2022-gdp-by-state-and-kind-of-economic-activity-at-constan.csv",
      "format": {
        "type": "csv",
        "parse": { "Year": "number", "Value RM Million": "number" }
      }
    },
    "transform": [
      { "filter": "datum.Year == year_select" },
      {
        "filter": "datum.State != 'W.P. Kuala Lumpur' && datum.State != 'W.P. Labuan' && datum.State != 'W.P. Putrajaya'"
      },
      { "filter": "isValid(datum['Value RM Million'])" },
      { "filter": "isValid(datum.State) && isValid(datum['Kind of Economic Activity'])" }
    ],
    "mark": { "type": "bar" },
    "encoding": {
      "y": {
        "field": "State",
        "type": "nominal",
        "sort": {
          "op": "sum",
          "field": "Value RM Million",
          "order": "descending"
        },
        "axis": { "title": "State" }
      },
      "x": {
        "aggregate": "sum",
        "field": "Value RM Million",
        "type": "quantitative",
        "axis": { "title": "RM Million" }
      },
      "color": {
        "field": "Kind of Economic Activity",
        "type": "nominal",
        "scale": { "scheme": "tableau10" },
        "legend": {
          "title": "Economic Activity",
          "orient": "right",
          "direction": "vertical",
          "labelLimit": 300
        },
        "sort": {
          "op": "sum",
          "field": "Value RM Million",
          "order": "descending"
        }
      },
      "tooltip": [
        { "field": "State", "title": "State" },
        { "field": "Kind of Economic Activity", "title": "Activity" },
        {
          "aggregate": "sum",
          "field": "Value RM Million",
          "title": "Value (RM Million)",
          "type": "quantitative",
          "format": ",.0f"
        },
        { "field": "Year", "title": "Year" }
      ],
      "order": {
        "aggregate": "sum",
        "field": "Value RM Million",
        "sort": "descending"
      }
    },
    "config": {
      "view": { "stroke": null },
      "axis": { "labelFontSize": 11, "titleFontSize": 12 },
      "legend": { "titleFontSize": 12, "labelFontSize": 11 }
    }
  }
  